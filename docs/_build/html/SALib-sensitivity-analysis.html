<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Global Sensitivity Analysis with SALib methods &mdash; pynoddy  documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pynoddy  documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="global-sensitivity-analysis-with-salib-methods">
<h1>Global Sensitivity Analysis with SALib methods<a class="headerlink" href="#global-sensitivity-analysis-with-salib-methods" title="Permalink to this headline">¶</a></h1>
<p>The Python library SALib provides several global sensitivity analysis
methods (including Morris and Sobol). We will test here if (and how)
these methods can be applied to sensitivity analysis of Noddy models.</p>
<p>We will start with the simple two-fault model and then extend the
analysis to the Gippsland basin model.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="n">css_file</span> <span class="o">=</span> <span class="s">&#39;pynoddy.css&#39;</span>
<span class="n">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">css_file</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<link href='http://fonts.googleapis.com/css?family=Alegreya+Sans:100,300,400,500,700,800,900,100italic,300italic,400italic,500italic,700italic,800italic,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Arvo:400,700,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Mono' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Shadows+Into+Light' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Tangerine">
<link href='http://fonts.googleapis.com/css?family=Philosopher:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Karla:400,400italic' rel='stylesheet' type='text/css'>

<style>

@font-face {
    font-family: "Computer Modern";
    src: url('http://mirrors.ctan.org/fonts/cm-unicode/fonts/otf/cmunss.otf');
}

#notebook_panel { /* main background */
    background: #888;
    color: #f6f6f6;
}

div.cell { /* set cell width to about 80 chars */
    width: 800px;
}

div #notebook { /* centre the content */
    background: #fff; /* white background for content */
    width: 1000px;
    margin: auto;
    padding-left: 1em;
}

#notebook li { /* More space between bullet points */
margin-top:0.8em;
}

/* draw border around running cells */
div.cell.border-box-sizing.code_cell.running {
    border: 3px solid #111;
}

/* Put a solid color box around each cell and its output, visually linking them together */
div.cell.code_cell {
    background: #ddd;  /* rgba(230,230,230,1.0);  */
    border-radius: 10px; /* rounded borders */
    width: 900px;
    padding: 1em;
    margin-top: 1em;
}

div.text_cell_render{
    font-family: 'Arvo' sans-serif;
    line-height: 130%;
    font-size: 115%;
    width:700px;
    margin-left:auto;
    margin-right:auto;
}


/* Formatting for header cells */
.text_cell_render h1 {
    font-family: 'Alegreya Sans', sans-serif;
    /* font-family: 'Tangerine', serif; */
    /* font-family: 'Libre Baskerville', serif; */
    /* font-family: 'Karla', sans-serif;
    /* font-family: 'Lora', serif; */
    font-size: 50px;
    text-align: center;
    /* font-style: italic; */
    font-weight: 400;
    /* font-size: 40pt; */
    /* text-shadow: 4px 4px 4px #aaa; */
    line-height: 120%;
    color: rgb(12,85,97);
    margin-bottom: .5em;
    margin-top: 0.1em;
    display: block;
}
.text_cell_render h2 {
    /* font-family: 'Arial', serif; */
    /* font-family: 'Lora', serif; */
    font-family: 'Alegreya Sans', sans-serif;
    font-weight: 700;
    font-size: 24pt;
    line-height: 100%;
    /* color: rgb(171,165,131); */
    color: rgb(12,85,97);
    margin-bottom: 0.1em;
    margin-top: 0.1em;
    display: block;
}

.text_cell_render h3 {
    font-family: 'Arial', serif;
    margin-top:12px;
    margin-bottom: 3px;
    font-style: italic;
    color: rgb(95,92,72);
}

.text_cell_render h4 {
    font-family: 'Arial', serif;
}

.text_cell_render h5 {
    font-family: 'Alegreya Sans', sans-serif;
    font-weight: 300;
    font-size: 16pt;
    color: grey;
    font-style: italic;
    margin-bottom: .1em;
    margin-top: 0.1em;
    display: block;
}

.text_cell_render h6 {
    font-family: 'PT Mono', sans-serif;
    font-weight: 300;
    font-size: 10pt;
    color: grey;
    margin-bottom: 1px;
    margin-top: 1px;
}

.CodeMirror{
        font-family: "PT Mono";
        font-size: 100%;
}

</style></div>
<div class="section" id="setting-up-the-two-fault-model">
<h1>Setting up the two-fault model<a class="headerlink" href="#setting-up-the-two-fault-model" title="Permalink to this headline">¶</a></h1>
<p>We set up the two fault model as in the example of the local sensitivity
analysis before:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="c"># adjust some settings for matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="c"># print rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
<span class="c"># determine path of repository to set paths corretly below</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">r&#39;/Users/flow/git/pynoddy/docs/notebooks/&#39;</span><span class="p">)</span>
<span class="n">repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s">&#39;../..&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pynoddy.history</span>
<span class="kn">import</span> <span class="nn">pynoddy.events</span>
</pre></div>
</div>
<div class="section" id="create-model-with-8-layers-and-two-faults">
<h2>Create model with 8 layers and two faults<a class="headerlink" href="#create-model-with-8-layers-and-two-faults" title="Permalink to this headline">¶</a></h2>
<p>We will first create a simple model with one stratigraphy, defining 8
layers with a thickness of 500 m, and two faults that are completely
symmetrical in their properties:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
<span class="n">nm</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">()</span>
<span class="c"># add stratigraphy</span>
<span class="n">strati_options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;num_layers&#39;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                  <span class="s">&#39;layer_names&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;layer 1&#39;</span><span class="p">,</span> <span class="s">&#39;layer 2&#39;</span><span class="p">,</span> <span class="s">&#39;layer 3&#39;</span><span class="p">,</span> <span class="s">&#39;layer 4&#39;</span><span class="p">,</span> <span class="s">&#39;layer 5&#39;</span><span class="p">,</span> <span class="s">&#39;layer 6&#39;</span><span class="p">,</span> <span class="s">&#39;layer 7&#39;</span><span class="p">,</span> <span class="s">&#39;layer 8&#39;</span><span class="p">],</span>
                  <span class="s">&#39;layer_thickness&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">]}</span>
<span class="n">nm</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="s">&#39;stratigraphy&#39;</span><span class="p">,</span> <span class="n">strati_options</span> <span class="p">)</span>

<span class="c"># The following options define the fault geometry:</span>
<span class="n">fault_options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;Fault_W&#39;</span><span class="p">,</span>
                 <span class="s">&#39;pos&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">),</span>
                 <span class="s">&#39;dip_dir&#39;</span> <span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
                 <span class="s">&#39;dip&#39;</span> <span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                 <span class="s">&#39;slip&#39;</span> <span class="p">:</span> <span class="mi">1000</span><span class="p">}</span>

<span class="n">nm</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="s">&#39;fault&#39;</span><span class="p">,</span> <span class="n">fault_options</span><span class="p">)</span>
<span class="c"># The following options define the fault geometry:</span>
<span class="n">fault_options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;Fault_E&#39;</span><span class="p">,</span>
                 <span class="s">&#39;pos&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">6000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">),</span>
                 <span class="s">&#39;dip_dir&#39;</span> <span class="p">:</span> <span class="mi">270</span><span class="p">,</span>
                 <span class="s">&#39;dip&#39;</span> <span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
                 <span class="s">&#39;slip&#39;</span> <span class="p">:</span> <span class="mi">1000</span><span class="p">}</span>

<span class="n">nm</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="s">&#39;fault&#39;</span><span class="p">,</span> <span class="n">fault_options</span><span class="p">)</span>
<span class="n">history</span> <span class="o">=</span> <span class="s">&quot;two_faults_sensi.his&quot;</span>
<span class="n">nm</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># compute the model:</span>
<span class="n">output_name</span> <span class="o">=</span> <span class="s">&quot;two_faults_sensi_out&quot;</span>
<span class="c"># Compute the model</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">output_name</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Plot output</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<span class="n">nout</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>
<span class="n">nout</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">layer_labels</span> <span class="o">=</span> <span class="n">strati_options</span><span class="p">[</span><span class="s">&#39;layer_names&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">colorbar</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>
                  <span class="n">savefig</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_7_0.png" src="_images/SALib-sensitivity-analysis_7_0.png" />
</div>
<div class="section" id="analyse-series-in-virtual-drillhole">
<h2>Analyse series in virtual drillhole<a class="headerlink" href="#analyse-series-in-virtual-drillhole" title="Permalink to this headline">¶</a></h2>
<p>The NoddyHistory class now has a function to evaluate geological units
in a &#8220;virtual drillhole&#8221;, i.e.: a 1-D extraction at a given position
(x,y). Basically, a model is created with the same kinematic history,
but a very small range (around the position x,y), and a small cube size
(default: 1 m) for a &#8220;quasi-continuous&#8221; model export.</p>
<p>The idea is that the data of this &#8220;virtual drillhole&#8221; could be used for
a meaningful sensitivity analysis, as the data is almost continuous.</p>
<p>Here an example of a 1-D export. First, we re-open the model created
above and get some model information:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
<span class="n">nm_2</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
<span class="n">nm_2</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="s">&quot;test2.his&quot;</span><span class="p">)</span>
<span class="n">nm_2</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<pre class="literal-block">
 STRATIGRAPHY
 FAULT
 FAULT
<strong>********************************************************</strong>
                    Model Information
<strong>********************************************************</strong>


This model consists of 3 events:
    (1) - STRATIGRAPHY
    (2) - FAULT
    (3) - FAULT
The model extent is:
    x - 10000.0 m
    y - 7000.0 m
    z - 5000.0 m
Number of cells in each direction:
    nx = 200
    ny = 140
    nz = 100
The model origin is located at:
    (0.0, 0.0, 5000.0)
The cubesize for model export is:
    50 m


<strong>********************************************************</strong>
                    Meta Data
<strong>********************************************************</strong>


The filename of the model is:
    test2.his
It was last saved (if origin was a history file!) at:
     3/1/2015 9:55:57
</pre>
<p>Let&#8217;s export the geology at a 1-D profile/ virtual borehole at the
centre of the model (x = 5000, y = 3500). Note: the resolution of the
exported profile can be defined with an additional keyword (resolution
higher than 1 m are possible, as well):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># get 1-D line export at centre of model:</span>
<span class="n">drill_1</span> <span class="o">=</span> <span class="n">nm_2</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>A plot of the data looks, so far, pretty boring:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">drill_1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">drill_1</span><span class="p">),</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x1085a04d0&gt;]
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_13_1.png" src="_images/SALib-sensitivity-analysis_13_1.png" />
</div>
<div class="section" id="evaluate-effect-of-fault-uncertainties-on-drillhole">
<h2>Evaluate effect of fault uncertainties on drillhole<a class="headerlink" href="#evaluate-effect-of-fault-uncertainties-on-drillhole" title="Permalink to this headline">¶</a></h2>
<p>We now assign uncertainties to the fault parameters and see how these
uncertainties affect the model - at the exported drillhole 1-D profile.</p>
<p>The history class contains a simple method to change event parameters:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># set parameter changes in dictionary</span>

<span class="c"># define the elemtents and values of the events to change:</span>
<span class="n">changes_fault_1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">}</span>
<span class="n">changes_fault_2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">}</span>

<span class="c"># Assign those changes to the events (note: event ids)</span>
<span class="n">param_changes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span> <span class="p">:</span> <span class="n">changes_fault_1</span><span class="p">,</span>
                 <span class="mi">3</span> <span class="p">:</span> <span class="n">changes_fault_2</span><span class="p">}</span>

<span class="c"># Perform changes</span>
<span class="n">nm_2</span><span class="o">.</span><span class="n">change_event_params</span><span class="p">(</span><span class="n">param_changes</span><span class="p">)</span>
</pre></div>
</div>
<p>As the <code class="docutils literal"><span class="pre">get_drillhole_data</span></code> method automatically performs the model
computation step, we can simply get the updated 1-D profile as:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">drill_2</span> <span class="o">=</span> <span class="n">nm_2</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If we now compare the new profile to the previous one we can observe the
changes:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">drill_1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">drill_1</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;original model&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">drill_2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">drill_1</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;changed model&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">&#39;lower left&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.legend.Legend at 0x1084bc450&gt;
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_19_1.png" src="_images/SALib-sensitivity-analysis_19_1.png" />
<p>So, as expected, we obtain a different 1-D profile. Important to note
here is that the resolution of this 1-D export is a lot higher than the
model we would obtain with the full 3-D export so that we can use it as
a &#8220;quasi-continuous&#8221; representation at this one position (x,y). This
aspect is important for the sensitivity analysis below.</p>
<p>We can, however, just for the purpose of visualising the changes between
these two models, also create a quick comparison of slices through the
model:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># compute updated model</span>
<span class="n">updated_history</span> <span class="o">=</span> <span class="s">&quot;changed_fault_model.his&quot;</span>
<span class="n">updated_out</span> <span class="o">=</span> <span class="s">&quot;changed_fault_model_out&quot;</span>
<span class="n">nm_2</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">updated_history</span><span class="p">)</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">updated_history</span><span class="p">,</span> <span class="n">updated_out</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">nout</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">output_name</span><span class="p">)</span>
<span class="n">nout_2</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">updated_out</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

<span class="n">nout</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">layer_labels</span> <span class="o">=</span> <span class="n">strati_options</span><span class="p">[</span><span class="s">&#39;layer_names&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">colorbar</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span>
                  <span class="n">savefig</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="c"># plot position of drillhole</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="n">nout_2</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">layer_labels</span> <span class="o">=</span> <span class="n">strati_options</span><span class="p">[</span><span class="s">&#39;layer_names&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">colorbar</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">,</span>
                  <span class="n">savefig</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="c"># plot position of drillhole</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.lines.Line2D at 0x109ee6c10&gt;
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_22_1.png" src="_images/SALib-sensitivity-analysis_22_1.png" />
<p>The difference between the two models is also obvious in the
cross-section - but the resolution is a lot lower (as can be seen from
the stair-step faults). However, exporting the entire model in the same
resolution as the 1-D profile is prohibitive for memory and computation
time reasons - so we will use the 1-D profiles from now on for
uncertainty analysis and sensitivity testing.</p>
</div>
<div class="section" id="defining-an-objective-function">
<h2>Defining an objective function<a class="headerlink" href="#defining-an-objective-function" title="Permalink to this headline">¶</a></h2>
<p>The next step is to define an objective function based on the exported
1-D profile. This is a bit tricky to do for a general case. Note, for
example, that the profile of the &#8220;original model&#8221; only contains the
layers from 8 to 5, whereas the changed model contains layers 8 to 3!</p>
<p>So, we need a way to describe the &#8220;distance&#8221; between the two profiles.
As a first test, let&#8217;s use a &#8220;stratigraphic distance&#8221; where we calculate
for each cell the difference between the geological layer id between the
changed model and the original model, then sum the absolute values and
scale by the number of cells.</p>
<p>We define a distance function:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">profile_ori</span><span class="p">,</span> <span class="n">profile_changed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the relative stratigraphic distance along a profile&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">profile_ori</span> <span class="o">-</span> <span class="n">profile_changed</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">profile_ori</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">distance</span><span class="p">(</span><span class="n">drill_1</span><span class="p">,</span> <span class="n">drill_2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">0.54979999999999996</span>
</pre></div>
</div>
<p>Note: the distance can be larger than 1 (as it should be the case!).</p>
</div>
<div class="section" id="comparing-distances-for-increasing-model-differences">
<h2>Comparing distances for increasing model differences<a class="headerlink" href="#comparing-distances-for-increasing-model-differences" title="Permalink to this headline">¶</a></h2>
<p>Just to see if the distance method makes sense: let&#8217;s compare distances
as a couple of locations in the model - for increasing difference in
fault dips on both sides.</p>
<p>We start again with the original two-fault model:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="p">)</span>
<span class="n">nm_ori</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">STRATIGRAPHY</span>
<span class="n">FAULT</span>
<span class="n">FAULT</span>
</pre></div>
</div>
<p>And we now use a some more &#8220;drillhole&#8221; positions:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">drill_ori_left</span> <span class="o">=</span> <span class="n">nm_ori</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
<span class="n">drill_ori_fault</span> <span class="o">=</span> <span class="n">nm_ori</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
<span class="n">drill_ori_centre</span> <span class="o">=</span> <span class="n">nm_ori</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
<span class="c"># drill_ori_right = nm_ori.get_drillhole_data(8000, 3500)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">drill_ori_left</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">drill_ori_left</span><span class="p">),</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">drill_ori_fault</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">drill_ori_left</span><span class="p">),</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">drill_ori_centre</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">drill_ori_left</span><span class="p">),</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x10b7f9b10&gt;]
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_32_1.png" src="_images/SALib-sensitivity-analysis_32_1.png" />
<p>We now change the fault dips (to 20 degrees in increments of 1),
recopmute the drillhole profiles and calculate the distances:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">copy</span>
<span class="n">nm_changed</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nm_ori</span><span class="p">)</span>
<span class="n">dist_left</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dist_fault</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dist_centre</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="c"># define the elemtents and values of the events to change:</span>
    <span class="n">changes_fault_1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
    <span class="n">changes_fault_2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>

    <span class="c"># Assign those changes to the events (note: event ids)</span>
    <span class="n">param_changes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span> <span class="p">:</span> <span class="n">changes_fault_1</span><span class="p">,</span>
                     <span class="mi">3</span> <span class="p">:</span> <span class="n">changes_fault_2</span><span class="p">}</span>

    <span class="c"># Perform changes</span>
    <span class="n">nm_changed</span><span class="o">.</span><span class="n">change_event_params</span><span class="p">(</span><span class="n">param_changes</span><span class="p">)</span>

    <span class="c"># Export drillhole profiles</span>
    <span class="n">drill_changed_left</span> <span class="o">=</span> <span class="n">nm_changed</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
    <span class="n">drill_changed_fault</span> <span class="o">=</span> <span class="n">nm_changed</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
    <span class="n">drill_changed_centre</span> <span class="o">=</span> <span class="n">nm_changed</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>

    <span class="c"># calculate distances and add to arrays</span>
    <span class="n">dist_left</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">drill_ori_left</span><span class="p">,</span> <span class="n">drill_changed_left</span><span class="p">))</span>
    <span class="n">dist_fault</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">drill_ori_fault</span><span class="p">,</span> <span class="n">drill_changed_fault</span><span class="p">))</span>
    <span class="n">dist_centre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">drill_ori_centre</span><span class="p">,</span> <span class="n">drill_changed_centre</span><span class="p">))</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">dist_centre</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Centre&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span><span class="n">dist_left</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span><span class="n">dist_fault</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Fault&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;Model distance at three positions for increasing dip&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;Dip change&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;Mean stratigraphic distance&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_35_0.png" src="_images/SALib-sensitivity-analysis_35_0.png" />
<p>Distance is increasing for increasing dip, as expected - and
qualitatively, it looks ok, as well: the biggest model differences occur
in the range of the fault, then the central Graben, and the least
changes on the flanks.</p>
</div>
<div class="section" id="check-distance-for-small-dip-changes">
<h2>Check distance for small dip changes<a class="headerlink" href="#check-distance-for-small-dip-changes" title="Permalink to this headline">¶</a></h2>
<p>We increasd above by values of 1 degree - here just a quick check if we
also get a reasonable distance for very small changes, with a model
resolution of 1 m:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">nm_changed</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nm_ori</span><span class="p">)</span>
<span class="c"># define the elemtents and values of the events to change:</span>
<span class="n">changes_fault_1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">}</span>
<span class="n">changes_fault_2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">}</span>

<span class="c"># Assign those changes to the events (note: event ids)</span>
<span class="n">param_changes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span> <span class="p">:</span> <span class="n">changes_fault_1</span><span class="p">,</span>
                 <span class="mi">3</span> <span class="p">:</span> <span class="n">changes_fault_2</span><span class="p">}</span>

<span class="c"># Perform changes</span>
<span class="n">nm_changed</span><span class="o">.</span><span class="n">change_event_params</span><span class="p">(</span><span class="n">param_changes</span><span class="p">)</span>

<span class="c"># Export drillhole profiles</span>
<span class="n">drill_changed_left</span> <span class="o">=</span> <span class="n">nm_changed</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
<span class="n">drill_changed_fault</span> <span class="o">=</span> <span class="n">nm_changed</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
<span class="n">drill_changed_centre</span> <span class="o">=</span> <span class="n">nm_changed</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>

<span class="c"># calculate distances and add to arrays</span>
<span class="k">print</span> <span class="n">distance</span><span class="p">(</span><span class="n">drill_ori_left</span><span class="p">,</span> <span class="n">drill_changed_left</span><span class="p">)</span>
<span class="k">print</span> <span class="n">distance</span><span class="p">(</span><span class="n">drill_ori_fault</span><span class="p">,</span> <span class="n">drill_changed_fault</span><span class="p">)</span>
<span class="k">print</span> <span class="n">distance</span><span class="p">(</span><span class="n">drill_ori_centre</span><span class="p">,</span> <span class="n">drill_changed_centre</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">0.0014</span>
<span class="mf">0.0044</span>
<span class="mf">0.0056</span>
</pre></div>
</div>
</div>
<div class="section" id="distance-convergence-with-incresing-resolution">
<h2>Distance convergence with incresing resolution<a class="headerlink" href="#distance-convergence-with-incresing-resolution" title="Permalink to this headline">¶</a></h2>
<p>A last quick check: let&#8217;s see how the drillhole resolution affects the
distance calculation, i.e.: which resolution do we need to get a stable
distance estimate?</p>
<p>We will test three cases: a very small dip change (0.01 degree), a small
change (0.1 degree), and a larger change (10 degree). For each of these
changes, we will increase the drillhole resolution, starting from 10 m,
down to 0.1 m and calculate distances for the drillhole position at the
position of the fault:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># use logarithmic steps for resolution:</span>
<span class="n">resolution_inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Check distance for drillhole resolutions of:&quot;</span>
<span class="k">print</span> <span class="n">resolution_inc</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Check distance for drillhole resolutions of:
[  1.           1.17876863   1.38949549   1.63789371   1.93069773
   2.27584593   2.6826958    3.16227766   3.72759372   4.39397056
   5.17947468   6.1054023    7.19685673   8.48342898  10.        ]
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">distances</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dips</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="k">for</span> <span class="n">dip</span> <span class="ow">in</span> <span class="n">dips</span><span class="p">:</span> <span class="c"># initialise dictionary to store results</span>
    <span class="n">distances</span><span class="p">[</span><span class="n">dip</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">resolution_inc</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">res</span>
    <span class="k">for</span> <span class="n">dip</span> <span class="ow">in</span> <span class="n">dips</span><span class="p">:</span>
        <span class="c"># create a copy of the history object</span>
        <span class="n">nm_changed</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nm_ori</span><span class="p">)</span>

        <span class="c"># define the elemtents and values of the events to change:</span>
        <span class="n">changes_fault_1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="n">dip</span><span class="p">}</span>
        <span class="n">changes_fault_2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="n">dip</span><span class="p">}</span>

        <span class="c"># Assign those changes to the events (note: event ids)</span>
        <span class="n">param_changes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span> <span class="p">:</span> <span class="n">changes_fault_1</span><span class="p">,</span>
                         <span class="mi">3</span> <span class="p">:</span> <span class="n">changes_fault_2</span><span class="p">}</span>

        <span class="c"># Perform changes</span>
        <span class="n">nm_changed</span><span class="o">.</span><span class="n">change_event_params</span><span class="p">(</span><span class="n">param_changes</span><span class="p">)</span>

        <span class="c"># Export drillhole profiles</span>
        <span class="c"># drill_changed_left = nm_changed.get_drillhole_data(2000, 3500)</span>
        <span class="n">drill_changed_fault</span> <span class="o">=</span> <span class="n">nm_changed</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">res</span><span class="p">)</span>
        <span class="n">drill_ori_fault</span> <span class="o">=</span> <span class="n">nm_ori</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">res</span><span class="p">)</span>
        <span class="c"># drill_changed_centre = nm_changed.get_drillhole_data(5000, 3500)</span>

        <span class="c"># calculate distances and add to arrays</span>
        <span class="c"># dist_left.append(distance(drill_ori_left, drill_changed_left))</span>
        <span class="n">distances</span><span class="p">[</span><span class="n">dip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">drill_ori_fault</span><span class="p">,</span> <span class="n">drill_changed_fault</span><span class="p">))</span>
        <span class="c"># dist_centre.append(distance(drill_ori_centre, drill_changed_centre))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">1.0</span>
<span class="mf">1.17876863479</span>
<span class="mf">1.38949549437</span>
<span class="mf">1.63789370695</span>
<span class="mf">1.93069772888</span>
<span class="mf">2.27584592607</span>
<span class="mf">2.68269579528</span>
<span class="mf">3.16227766017</span>
<span class="mf">3.72759372031</span>
<span class="mf">4.39397056076</span>
<span class="mf">5.17947467923</span>
<span class="mf">6.10540229659</span>
<span class="mf">7.19685673001</span>
<span class="mf">8.48342898244</span>
<span class="mf">10.0</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">distances</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.047199999999999999</span><span class="p">,</span> <span class="mf">0.05569978758555582</span><span class="p">,</span> <span class="mf">0.06561023074784543</span><span class="p">,</span> <span class="mf">0.020669291338582679</span><span class="p">,</span> <span class="mf">0.02084942084942085</span><span class="p">,</span> <span class="mf">0.053832116788321165</span><span class="p">,</span> <span class="mf">0.063270777479892765</span><span class="p">,</span> <span class="mf">0.049936788874841972</span><span class="p">,</span> <span class="mf">0.058955223880597013</span><span class="p">,</span> <span class="mf">0.055360281195079089</span><span class="p">,</span> <span class="mf">0.048704663212435231</span><span class="p">,</span> <span class="mf">0.047677261613691929</span><span class="p">,</span> <span class="mf">0.047550432276657062</span><span class="p">,</span> <span class="mf">0.052631578947368418</span><span class="p">,</span> <span class="mf">0.051999999999999998</span><span class="p">],</span> <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4824</span><span class="p">,</span> <span class="mf">0.56927071040830779</span><span class="p">,</span> <span class="mf">0.67055879899916593</span><span class="p">,</span> <span class="mf">0.5508530183727034</span><span class="p">,</span> <span class="mf">0.34633204633204634</span><span class="p">,</span> <span class="mf">0.55018248175182483</span><span class="p">,</span> <span class="mf">0.64664879356568361</span><span class="p">,</span> <span class="mf">0.50821744627054366</span><span class="p">,</span> <span class="mf">0.59999999999999998</span><span class="p">,</span> <span class="mf">0.53075571177504388</span><span class="p">,</span> <span class="mf">0.49948186528497407</span><span class="p">,</span> <span class="mf">0.49144254278728605</span><span class="p">,</span> <span class="mf">0.49567723342939479</span><span class="p">,</span> <span class="mf">0.51273344651952457</span><span class="p">,</span> <span class="mf">0.48399999999999999</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0044000000000000003</span><span class="p">,</span> <span class="mf">0.0051923530800094403</span><span class="p">,</span> <span class="mf">0.0061162079510703364</span><span class="p">,</span> <span class="mf">0.0022965879265091863</span><span class="p">,</span> <span class="mf">0.0023166023166023165</span><span class="p">,</span> <span class="mf">0.0041058394160583944</span><span class="p">,</span> <span class="mf">0.0048257372654155499</span><span class="p">,</span> <span class="mf">0.0037926675094816687</span><span class="p">,</span> <span class="mf">0.0044776119402985077</span><span class="p">,</span> <span class="mf">0.0070298769771528994</span><span class="p">,</span> <span class="mf">0.0031088082901554403</span><span class="p">,</span> <span class="mf">0.0048899755501222494</span><span class="p">,</span> <span class="mf">0.0043227665706051877</span><span class="p">,</span> <span class="mf">0.0050933786078098476</span><span class="p">,</span> <span class="mf">0.0040000000000000001</span><span class="p">]}</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">resolution_inc</span><span class="p">,</span> <span class="n">distances</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;10$^o$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">resolution_inc</span><span class="p">,</span> <span class="n">distances</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;0.1$^o$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">resolution_inc</span><span class="p">,</span> <span class="n">distances</span><span class="p">[</span><span class="mf">0.1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;0.01$^o$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.legend.Legend at 0x10bcb7350&gt;
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_43_1.png" src="_images/SALib-sensitivity-analysis_43_1.png" />
<p>Results are a bit odd - to do: check implementation of resolution!</p>
</div>
</div>
<div class="section" id="sensitivity-analysis">
<h1>Sensitivity analysis<a class="headerlink" href="#sensitivity-analysis" title="Permalink to this headline">¶</a></h1>
<p>We have got the single parts now for the sensitivity analysis. We are
now using the global sensitivity analysis methods of the Python package
SALib, available on:</p>
<p><a class="reference external" href="https://github.com/jdherman/SALib">https://github.com/jdherman/SALib</a></p>
<p>As a start, we will test the sensitivity of the model at each drillhole
position separately. As parameters, we will use the parameters of the
fault events: dip, dip direction, and slip.</p>
<div class="section" id="parameter-generation-with-salib">
<h2>Parameter generation with SALib<a class="headerlink" href="#parameter-generation-with-salib" title="Permalink to this headline">¶</a></h2>
<p>The first step for a sensitivity analysis with SALib is to create a text
file with a list of parameters and defined ranges for each parameter.
Note that we define changes to the parameter (as this is the way we
implement the changes with the <code class="docutils literal"><span class="pre">NoddyHistory.change_event_params</span></code>
method):</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">param_file</span> <span class="o">=</span> <span class="s">&quot;params.txt&quot;</span>
<span class="n">params</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;dip_change_fault_1 -5.0 5.0</span>
<span class="s">dip_dir_change_fault_1 -5.0 5.0</span>
<span class="s">slip_change_fault_1 -100. 100.</span>
<span class="s">dip_change_fault_2 -5.0 5.0</span>
<span class="s">dip_dir_change_fault_2 -5.0 5.0</span>
<span class="s">slip_change_fault_2 -100. 100.&quot;&quot;&quot;</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">param_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, we create samples for these parameters. The way the samples are
generated depends on the type of sensitivity analysis. We are starting
with the Sobol method and create samples:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">SALib.sample</span> <span class="kn">import</span> <span class="n">saltelli</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">param_values</span> <span class="o">=</span> <span class="n">saltelli</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">param_file</span><span class="p">,</span> <span class="n">calc_second_order</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>With this command, we create a 2-D array where each row contains a set
of parameters for our model.</p>
<p>The number of generated samples depends on (1) the number of input
parameters, (2) the type of sensitivity analysis, and (3) the choice of
calculating second-order sensitivities (for parameter correlation).</p>
</div>
<div class="section" id="running-the-models">
<h2>Running the models<a class="headerlink" href="#running-the-models" title="Permalink to this headline">¶</a></h2>
<p>We now use this array and run the parameters through our model. Results
are again stored in a text file. For simplicity, we will define a
function that takes a parameter array, creates the new model, and
calculates the distance to the original model at the position of the
drillhole:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="p">)</span>
<span class="n">nm_ori</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">NoddyHistory</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>

<span class="c"># set resolution for analysis:</span>
<span class="n">res</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># m</span>

<span class="c"># get original model distance again:</span>
<span class="n">drill_ori_fault</span> <span class="o">=</span> <span class="n">nm_ori</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">res</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">change_model_with_paramter_array</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c"># create a copy of the history object</span>
    <span class="n">nm_changed</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nm_ori</span><span class="p">)</span>

    <span class="c"># define the elemtents and values of the events to change.</span>
    <span class="c"># Note: the order of parameters is as in the text file created above!</span>
    <span class="n">changes_fault_1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="s">&#39;Dip Direction&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                       <span class="s">&#39;Slip&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
    <span class="n">changes_fault_2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                       <span class="s">&#39;Dip Direction&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                       <span class="s">&#39;Slip&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">]}</span>

    <span class="c"># Assign those changes to the events (note: event ids)</span>
    <span class="n">param_changes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span> <span class="p">:</span> <span class="n">changes_fault_1</span><span class="p">,</span>
                     <span class="mi">3</span> <span class="p">:</span> <span class="n">changes_fault_2</span><span class="p">}</span>

    <span class="c"># Perform changes</span>
    <span class="n">nm_changed</span><span class="o">.</span><span class="n">change_event_params</span><span class="p">(</span><span class="n">param_changes</span><span class="p">)</span>

    <span class="n">nm_changed</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="s">&quot;salib_his_</span><span class="si">%02d</span><span class="s">.his&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>

    <span class="c"># Export drillhole profiles</span>
    <span class="c"># drill_changed_left = nm_changed.get_drillhole_data(2000, 3500)</span>
    <span class="n">drill_changed_fault</span> <span class="o">=</span> <span class="n">nm_changed</span><span class="o">.</span><span class="n">get_drillhole_data</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">res</span><span class="p">)</span>
    <span class="c"># drill_changed_centre = nm_changed.get_drillhole_data(5000, 3500)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">&quot;salib_drill_</span><span class="si">%02d</span><span class="s">.csv&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">drill_changed_fault</span><span class="p">)</span>

    <span class="c"># calculate and return distance:</span>
    <span class="k">return</span> <span class="n">distance</span><span class="p">(</span><span class="n">drill_ori_fault</span><span class="p">,</span> <span class="n">drill_changed_fault</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">STRATIGRAPHY</span>
<span class="n">FAULT</span>
<span class="n">FAULT</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>np.savetxt??
</pre></div>
</div>
<p>We can calculate the distance for any parameter set defined in the
model:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">param_set</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">change_model_with_paramter_array</span><span class="p">(</span><span class="n">param_values</span><span class="p">[</span><span class="n">param_set</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Distance for parameter set </span><span class="si">%d</span><span class="s">: </span><span class="si">%.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">param_set</span><span class="p">,</span><span class="n">dist</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>{2: {&#39;Dip&#39;: -4.541015625, &#39;Dip Direction&#39;: 3.994140625, &#39;Slip&#39;: 0.1953125}, 3: {&#39;Dip&#39;: -4.306640625, &#39;Dip Direction&#39;: -4.150390625, &#39;Slip&#39;: -49.0234375}}
Distance for parameter set 0: 0.2994
</pre></div>
</div>
<p>Now, we run the entire parameter set through the model and store the
results in a text file:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">dist_sensi</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">param_values</span><span class="p">:</span>
    <span class="n">dist_sensi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_model_with_paramter_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.802734375</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.033203125</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">3.7109375</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="mf">1.767578125</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.197265625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">81.4453125</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.541015625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.033203125</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">3.7109375</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="mf">1.767578125</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.197265625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">81.4453125</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.802734375</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="mf">3.994140625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">3.7109375</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="mf">1.767578125</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.197265625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">81.4453125</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.802734375</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.033203125</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">0.1953125</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="mf">1.767578125</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.197265625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">81.4453125</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.802734375</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.033203125</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">3.7109375</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.306640625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.197265625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">81.4453125</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.802734375</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.033203125</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">3.7109375</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="mf">1.767578125</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.150390625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">81.4453125</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.802734375</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.033203125</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">3.7109375</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="mf">1.767578125</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.197265625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">49.0234375</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.802734375</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="mf">3.994140625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">0.1953125</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.306640625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.150390625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">49.0234375</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.541015625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.033203125</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">0.1953125</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.306640625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.150390625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">49.0234375</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.541015625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="mf">3.994140625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">3.7109375</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.306640625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.150390625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">49.0234375</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.541015625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="mf">3.994140625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">0.1953125</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="mf">1.767578125</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.150390625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">49.0234375</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.541015625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="mf">3.994140625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">0.1953125</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.306640625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.197265625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">49.0234375</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.541015625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="mf">3.994140625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">0.1953125</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.306640625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.150390625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">81.4453125</span><span class="p">}}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.541015625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="mf">3.994140625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="mf">0.1953125</span><span class="p">},</span> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.306640625</span><span class="p">,</span> <span class="s">&#39;Dip Direction&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.150390625</span><span class="p">,</span> <span class="s">&#39;Slip&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">49.0234375</span><span class="p">}}</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="n">drill_changed_fault</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x10dfd42d0&gt;]
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_59_1.png" src="_images/SALib-sensitivity-analysis_59_1.png" />
<p>Look at sensitivities to check if we actually changed different
&#8220;quasi-continuous&#8221; values:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="n">dist_sensi</span><span class="p">,</span> <span class="s">&#39;o-&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x10e296190&gt;]
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_61_1.png" src="_images/SALib-sensitivity-analysis_61_1.png" />
<p>We now save the sensitivities to a file and then perform the sobol
sensitivity analysis:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># save results</span>
<span class="n">results_file</span> <span class="o">=</span> <span class="s">&#39;dist_sensi_graben.txt&#39;</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">results_file</span><span class="p">,</span> <span class="n">dist_sensi</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">SALib.analyze</span> <span class="kn">import</span> <span class="n">sobol</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">Si</span> <span class="o">=</span> <span class="n">sobol</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">param_file</span><span class="p">,</span> <span class="n">results_file</span><span class="p">,</span>
                   <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="n">conf_level</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
                   <span class="n">calc_second_order</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                   <span class="n">print_to_console</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># create composite matrix for sensitivities</span>
<span class="n">n_params</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">comp_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_params</span><span class="p">,</span><span class="n">n_params</span><span class="p">))</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_params</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_params</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">comp_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Si</span><span class="p">[</span><span class="s">&#39;S1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comp_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Si</span><span class="p">[</span><span class="s">&#39;S2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
            <span class="n">comp_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Si</span><span class="p">[</span><span class="s">&#39;S2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>

<span class="c"># print comp_matrix</span>

<span class="c"># define labels for figure: phi = dip, d = dip direction, s = slip, subscript = fault event</span>
<span class="n">label_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;$\phi_1$&quot;</span><span class="p">,</span> <span class="s">&quot;$d_1$&quot;</span><span class="p">,</span> <span class="s">&quot;$s_1$&quot;</span><span class="p">,</span> <span class="s">&quot;$\phi_2$&quot;</span><span class="p">,</span> <span class="s">&quot;$d_2$&quot;</span><span class="p">,</span> <span class="s">&quot;$s_2$&quot;</span><span class="p">]</span>

<span class="c"># Create figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">comp_matrix</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;RdBu_r&#39;</span><span class="p">,</span>
               <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">comp_matrix</span><span class="p">)),</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">comp_matrix</span><span class="p">)),</span>

<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s">&quot;both&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s">&quot;top&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">label_names</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">label_names</span><span class="p">)</span>

<span class="c"># ax.set_title(&quot;Sensitivities&quot;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;Parameter Sensitivities&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_66_0.png" src="_images/SALib-sensitivity-analysis_66_0.png" />
</div>
<div class="section" id="discussion-interpretation-of-sensitivities">
<h2>Discussion: interpretation of sensitivities<a class="headerlink" href="#discussion-interpretation-of-sensitivities" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s first have a look at the actual position of the &#8220;drillhole&#8221; that
we analyse with this sensitivity analysis:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># re-compute original model, just in case:</span>
<span class="n">ori_history</span> <span class="o">=</span> <span class="s">&quot;fault_ori.his&quot;</span>
<span class="n">ori_out</span> <span class="o">=</span> <span class="s">&quot;fault_ori_out&quot;</span>
<span class="n">nm_ori</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">ori_history</span><span class="p">)</span>
<span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">ori_history</span><span class="p">,</span> <span class="n">ori_out</span><span class="p">)</span>

<span class="n">no_ori</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">ori_out</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">no_ori</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">layer_labels</span> <span class="o">=</span> <span class="n">strati_options</span><span class="p">[</span><span class="s">&#39;layer_names&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">colorbar</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span>
                  <span class="n">savefig</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="c"># plot position of drillhole</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_69_0.png" src="_images/SALib-sensitivity-analysis_69_0.png" />
<p>The position of the &#8220;drillhole&#8221; is actually at 4000 m (cell 40),
coinciding with the position of the first fault:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&quot;Position of first fault:</span><span class="se">\t</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">nm_ori</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Position of second fault:</span><span class="se">\t</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">nm_ori</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Position of first fault:    4000.00
Position of second fault:   6000.00
</pre></div>
</div>
<p>So we could expect that the drillhole geology is sensitive to changes in
the parameters of this fault.</p>
<p>Still, the simulated model at this position is more sensitive to the
properties of the second fault, at position 6000 (see sensitivity
matrix)! This is a bit counter-intuitive, let&#8217;s see what actually
happens: we generate a couple of the realisations for the drawn
parameter sets and visualise the cross-sections:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># create base figure:</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="c"># create axis for figure</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">param_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">nm_changed</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nm_ori</span><span class="p">)</span>
    <span class="c"># read and assign parameter changes:</span>
    <span class="n">changes_fault_1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                       <span class="s">&#39;Dip Direction&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                       <span class="s">&#39;Slip&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
    <span class="n">changes_fault_2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dip&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                       <span class="s">&#39;Dip Direction&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                       <span class="s">&#39;Slip&#39;</span> <span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">]}</span>

    <span class="c"># Assign those changes to the events (note: event ids)</span>
    <span class="n">param_changes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span> <span class="p">:</span> <span class="n">changes_fault_1</span><span class="p">,</span>
                     <span class="mi">3</span> <span class="p">:</span> <span class="n">changes_fault_2</span><span class="p">}</span>

    <span class="c"># Perform changes</span>
    <span class="n">nm_changed</span><span class="o">.</span><span class="n">change_event_params</span><span class="p">(</span><span class="n">param_changes</span><span class="p">)</span>

    <span class="c"># compute model and create section:</span>
    <span class="n">tmp_his</span> <span class="o">=</span> <span class="s">&quot;fault_tmp.his&quot;</span>
    <span class="n">tmp_out</span> <span class="o">=</span> <span class="s">&quot;fault_tmp_out&quot;</span>
    <span class="n">nm_changed</span><span class="o">.</span><span class="n">write_history</span><span class="p">(</span><span class="n">tmp_his</span><span class="p">)</span>
    <span class="n">pynoddy</span><span class="o">.</span><span class="n">compute_model</span><span class="p">(</span><span class="n">tmp_his</span><span class="p">,</span> <span class="n">tmp_out</span><span class="p">)</span>
    <span class="n">no_changed</span> <span class="o">=</span> <span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">NoddyOutput</span><span class="p">(</span><span class="n">tmp_out</span><span class="p">)</span>

    <span class="n">no_changed</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">layer_labels</span> <span class="o">=</span> <span class="n">strati_options</span><span class="p">[</span><span class="s">&#39;layer_names&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">colorbar</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                      <span class="n">savefig</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

    <span class="c"># plot position of drillhole</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<img alt="_images/SALib-sensitivity-analysis_73_0.png" src="_images/SALib-sensitivity-analysis_73_0.png" />
<p>If we look at these results, it is quite good to see that the influence
of the right (second) fault is more important as it affects the entire
lower part of the &#8220;drillhole&#8221;. It is also obvious that the fault dip and
the fault slip play a major role (dip direction is actually quite
insiginficant as the profile is taken at the center of the model where
the fault position is defined).</p>
</div>
<div class="section" id="results-of-the-analysis">
<h2>Results of the analysis<a class="headerlink" href="#results-of-the-analysis" title="Permalink to this headline">¶</a></h2>
<p>With these considerations, here the interpretation for the results of
the sensitivity analysis:</p>
<p>We analysed the sensitivity of the modelled geology along a 1-D profile
(a virtual &#8220;drillhole&#8221;) with respect to fault parameters at two defined
fault events. A global sobol sensitivity analysis revealed that:</p>
<ol class="arabic simple">
<li>The profile data is most sensitive to the dip and slip of the late
(right) fault - which is initially a bit counter-intuitive as the
profile is at the position of the early (left) fault.</li>
<li>The profile is almost insensitive to the dip value of the early
fault, and literally insensitive to values of dip direction and slip
of the early fault.</li>
<li>Parameter correlations (second-order effects, off-diagonal in matrix)
show that the highest parameter correlation (with respect to the
profile) exist between dip and slip of the late fault. Furthermore,
the correlation is negative, indicating that an increase in dip can
be compensated with a decrease in fault slip. Given the position of
the fault and the profile, this results sense, as well.</li>
</ol>
<p>The result of the sensitivity analysis provides a good insight into the
sensitivities of modelled geology along a 1-D profile with respect to
event parameters. Results are initially a bit counter-intuitive, but
make perfect sense (and so, are actually quite interesting!).</p>
<p>The next step would now be to:</p>
<ol class="arabic simple">
<li>Extend the analysis to more than one position (not really sure if
this is possible with SALib), and</li>
<li>Apply the analysis to the Gippsland Basin model.</li>
</ol>
<p>I am actually quite happy with the first test and think that we could
get a nice analysis out for the Gippsland Basin - maybe also some
interesting counter-intuitive results!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Global Sensitivity Analysis with SALib methods</a></li>
<li><a class="reference internal" href="#setting-up-the-two-fault-model">Setting up the two-fault model</a><ul>
<li><a class="reference internal" href="#create-model-with-8-layers-and-two-faults">Create model with 8 layers and two faults</a></li>
<li><a class="reference internal" href="#analyse-series-in-virtual-drillhole">Analyse series in virtual drillhole</a></li>
<li><a class="reference internal" href="#evaluate-effect-of-fault-uncertainties-on-drillhole">Evaluate effect of fault uncertainties on drillhole</a></li>
<li><a class="reference internal" href="#defining-an-objective-function">Defining an objective function</a></li>
<li><a class="reference internal" href="#comparing-distances-for-increasing-model-differences">Comparing distances for increasing model differences</a></li>
<li><a class="reference internal" href="#check-distance-for-small-dip-changes">Check distance for small dip changes</a></li>
<li><a class="reference internal" href="#distance-convergence-with-incresing-resolution">Distance convergence with incresing resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sensitivity-analysis">Sensitivity analysis</a><ul>
<li><a class="reference internal" href="#parameter-generation-with-salib">Parameter generation with SALib</a></li>
<li><a class="reference internal" href="#running-the-models">Running the models</a></li>
<li><a class="reference internal" href="#discussion-interpretation-of-sensitivities">Discussion: interpretation of sensitivities</a></li>
<li><a class="reference internal" href="#results-of-the-analysis">Results of the analysis</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/SALib-sensitivity-analysis.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Florian Wellmann.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>