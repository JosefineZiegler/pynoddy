<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using the UncertaintyAnalysis class &mdash; pynoddy  documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pynoddy  documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="n">css_file</span> <span class="o">=</span> <span class="s">&#39;pynoddy.css&#39;</span>
<span class="n">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">css_file</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<link href='http://fonts.googleapis.com/css?family=Alegreya+Sans:100,300,400,500,700,800,900,100italic,300italic,400italic,500italic,700italic,800italic,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Arvo:400,700,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Mono' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Shadows+Into+Light' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Tangerine">
<link href='http://fonts.googleapis.com/css?family=Philosopher:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Lora:400,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Karla:400,400italic' rel='stylesheet' type='text/css'>

<style>

@font-face {
    font-family: "Computer Modern";
    src: url('http://mirrors.ctan.org/fonts/cm-unicode/fonts/otf/cmunss.otf');
}

#notebook_panel { /* main background */
    background: #888;
    color: #f6f6f6;
}

div.cell { /* set cell width to about 80 chars */
    width: 800px;
}

div #notebook { /* centre the content */
    background: #fff; /* white background for content */
    width: 1000px;
    margin: auto;
    padding-left: 1em;
}

#notebook li { /* More space between bullet points */
margin-top:0.8em;
}

/* draw border around running cells */
div.cell.border-box-sizing.code_cell.running {
    border: 3px solid #111;
}

/* Put a solid color box around each cell and its output, visually linking them together */
div.cell.code_cell {
    background: #ddd;  /* rgba(230,230,230,1.0);  */
    border-radius: 10px; /* rounded borders */
    width: 900px;
    padding: 1em;
    margin-top: 1em;
}

div.text_cell_render{
    font-family: 'Arvo' sans-serif;
    line-height: 130%;
    font-size: 115%;
    width:700px;
    margin-left:auto;
    margin-right:auto;
}


/* Formatting for header cells */
.text_cell_render h1 {
    font-family: 'Alegreya Sans', sans-serif;
    /* font-family: 'Tangerine', serif; */
    /* font-family: 'Libre Baskerville', serif; */
    /* font-family: 'Karla', sans-serif;
    /* font-family: 'Lora', serif; */
    font-size: 50px;
    text-align: center;
    /* font-style: italic; */
    font-weight: 400;
    /* font-size: 40pt; */
    /* text-shadow: 4px 4px 4px #aaa; */
    line-height: 120%;
    color: rgb(12,85,97);
    margin-bottom: .5em;
    margin-top: 0.1em;
    display: block;
}
.text_cell_render h2 {
    /* font-family: 'Arial', serif; */
    /* font-family: 'Lora', serif; */
    font-family: 'Alegreya Sans', sans-serif;
    font-weight: 700;
    font-size: 24pt;
    line-height: 100%;
    /* color: rgb(171,165,131); */
    color: rgb(12,85,97);
    margin-bottom: 0.1em;
    margin-top: 0.1em;
    display: block;
}

.text_cell_render h3 {
    font-family: 'Arial', serif;
    margin-top:12px;
    margin-bottom: 3px;
    font-style: italic;
    color: rgb(95,92,72);
}

.text_cell_render h4 {
    font-family: 'Arial', serif;
}

.text_cell_render h5 {
    font-family: 'Alegreya Sans', sans-serif;
    font-weight: 300;
    font-size: 16pt;
    color: grey;
    font-style: italic;
    margin-bottom: .1em;
    margin-top: 0.1em;
    display: block;
}

.text_cell_render h6 {
    font-family: 'PT Mono', sans-serif;
    font-weight: 300;
    font-size: 10pt;
    color: grey;
    margin-bottom: 1px;
    margin-top: 1px;
}

.CodeMirror{
        font-family: "PT Mono";
        font-size: 100%;
}

</style><div class="code python highlight-python"><div class="highlight"><pre>%matplotlib inline
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># here the usual imports. If any of the imports fails, make sure that pynoddy is installed</span>
<span class="c"># properly, ideally with &#39;python setup.py develop&#39; or &#39;python setup.py install&#39;</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># adjust some settings for matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="c"># print rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c"># determine path of repository to set paths corretly below</span>
<span class="n">repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s">&#39;../..&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pynoddy.history</span>
<span class="kn">import</span> <span class="nn">pynoddy.experiment.UncertaintyAnalysis</span>
<span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>

<span class="k">print</span> <span class="s">&quot;Success. Ignore? warnings here - scipy is funny sometimes.&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Success. Ignore? warnings here - scipy is funny sometimes.
</pre></div>
</div>
<div class="section" id="using-the-uncertaintyanalysis-class">
<h1>Using the UncertaintyAnalysis class<a class="headerlink" href="#using-the-uncertaintyanalysis-class" title="Permalink to this headline">Â¶</a></h1>
<p>Methods for visualising the lithological variability produced by
purturbation of the input datasets, which can be considered a proxy for
lithological uncertainty, are implemented in the UncertaintyAnalysis
class.</p>
<p>Initialisising a new UncertaintyAnalysis experiment is no different to
initialising a MonteCarlo experiment (as UncertaintyAnalysis uses this
class extensively) - we load a history file and associated csv file
defining the PDF&#8217;s to sample the input data from.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">UncertaintyAnalysis</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pynoddy.experiment.UncertaintyAnalysis</span> <span class="kn">import</span> <span class="n">UncertaintyAnalysis</span>


<span class="c"># the model itself is now part of the repository, in the examples directory:</span>
<span class="n">history_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="s">&quot;examples/fold_dyke_fault.his&quot;</span><span class="p">)</span>

<span class="c">#this file defines the statistical distributions to sample from</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="s">&quot;examples/fold_dyke_fault.csv&quot;</span><span class="p">)</span>

<span class="n">uc_experiment</span> <span class="o">=</span> <span class="n">UncertaintyAnalysis</span><span class="p">(</span><span class="n">history_file</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>

<span class="c">#plot the intial model</span>
<span class="n">uc_experiment</span><span class="o">.</span><span class="n">change_cube_size</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
<span class="n">uc_experiment</span><span class="o">.</span><span class="n">_mc</span><span class="o">.</span><span class="n">change_cube_size</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>


<span class="n">uc_experiment</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/14-Uncertainty-Analysis_4_0.png" src="_images/14-Uncertainty-Analysis_4_0.png" />
<p>The next step is to perform the Monte Carlo purturbation of this initial
model, and use this to estimate uncertainty. This sampling is wrapped
into the estimate_uncertainty function - all that is required from us
is the number of trials to produce. Realistically, several thousand
samples are typically necessary before sampling can be considered
representative. However, in order to speed things up a bit we&#8217;ll produce
10 model samples.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">uc_experiment</span><span class="o">.</span><span class="n">estimate_uncertainty</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, a quick description of what we have done... the
estimate_uncertainty function generates the specified amount (10) of
randomly varying models using the MonteCarlo class. It then loads the
output and loops calculates the lithology present at each voxel in each
model. This information is used to calculate probability maps for each
lithology at each point in the model! This can be seen if we plot the
probability of observing lithology 3:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">uc_experiment</span><span class="o">.</span><span class="n">plot_probability</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/14-Uncertainty-Analysis_8_0.png" src="_images/14-Uncertainty-Analysis_8_0.png" />
<p>These probability maps can then be used to calculate the information
entropy of each cell. These can then be plotted as follows:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">uc_experiment</span><span class="o">.</span><span class="n">plot_entropy</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/14-Uncertainty-Analysis_10_0.png" src="_images/14-Uncertainty-Analysis_10_0.png" />
<p>Areas with a high information entropy are shown in red, and correspond
to voxels with more variable lithology values. Hence, these voxels are
the most uncertain. This general approach can be used on nearly any
model, and gives a decent indication of areas with substantial
uncertainty.</p>
<p>Have fun!</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/14-Uncertainty-Analysis.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Florian Wellmann.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>