<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Analysis of uncertainty propagation with Monte Carlo sampling &mdash; pynoddy  documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pynoddy  documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="analysis-of-uncertainty-propagation-with-monte-carlo-sampling">
<h1>Analysis of uncertainty propagation with Monte Carlo sampling<a class="headerlink" href="#analysis-of-uncertainty-propagation-with-monte-carlo-sampling" title="Permalink to this headline">¶</a></h1>
<div class="code python highlight-python"><div class="highlight"><pre>from IPython.core.display import HTML
css_file = &#39;pynoddy.css&#39;
HTML(open(css_file, &quot;r&quot;).read())
%matplotlib inline
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># here the usual imports. If any of the imports fails, make sure that pynoddy is installed</span>
<span class="c"># properly, ideally with &#39;python setup.py develop&#39; or &#39;python setup.py install&#39;</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># adjust some settings for matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="c"># print rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c"># determine path of repository to set paths corretly below</span>
<span class="n">repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s">&#39;../..&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pynoddy.history</span>
<span class="kn">import</span> <span class="nn">pynoddy.experiment</span>
<span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>

<span class="k">print</span> <span class="s">&quot;Success. Ignore? warnings here - scipy is funny sometimes.&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Success. Ignore? warnings here - scipy is funny sometimes.
</pre></div>
</div>
<div class="section" id="using-the-monte-carlo-experiment-class">
<h2>Using the Monte-Carlo experiment class<a class="headerlink" href="#using-the-monte-carlo-experiment-class" title="Permalink to this headline">¶</a></h2>
<p>The methods for repeated Monte-Carlo sampling are integrated in a Python
experiment class. As before, we can therefore load the model and a
parameter file which defines the parameter statistics for the sampling
step:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">experiment</span><span class="p">)</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pynoddy.experiment.MonteCarlo</span> <span class="kn">import</span> <span class="n">MonteCarlo</span>

<span class="c"># the model itself is now part of the repository, in the examples directory:</span>
<span class="n">history_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="s">&quot;examples/fold_dyke_fault.his&quot;</span><span class="p">)</span>

<span class="c">#this file defines the statistical distributions to sample from</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="s">&quot;examples/fold_dyke_fault.csv&quot;</span><span class="p">)</span>

<span class="c">#now we initialise a MonteCarlo experiment</span>
<span class="n">gipps_mc</span> <span class="o">=</span> <span class="n">MonteCarlo</span><span class="p">(</span><span class="n">history_file</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>We now generate a specified amount of samples (8 in this example) and
run them through Noddy. Note that Noddy can be spawned in separate
threads: this example runs models in 4 different threads, reducing
runtime substantially (though naturally things still take a while,
especially when running more complex models).</p>
<p>It is also worth noting that we specify a random seed of 10 at this
point, so that an identical set of models is generated each time anyone
runs this notebook (ie. experiments are reproducible).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">n_draws</span> <span class="o">=</span> <span class="mi">8</span> <span class="c">#the number of models to produce</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span><span class="s">&#39;sandbox/out&#39;</span><span class="p">)</span> <span class="c">#the location to write models too</span>

<span class="n">gipps_mc</span><span class="o">.</span><span class="n">change_cube_size</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c">#change block size</span>
<span class="n">gipps_mc</span><span class="o">.</span><span class="n">generate_model_instances</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span><span class="n">n_draws</span><span class="p">,</span><span class="n">threads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> random model variations produced.&quot;</span> <span class="o">%</span> <span class="n">n_draws</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>8 random model variations produced.
</pre></div>
</div>
<p>Now that the model instances have been generated, we need to load them
into memory (from the output directory we specified earlier). The
easiest way to do this is to use a static method in the MonteCarlo
class: load_noddy_realisations.</p>
<p>MonteCarlo.load_noddy_realisations simply looks in the directory
provided and loads all of the noddy models it can find. It returns these
models as a list of NoddyOutput objects, which can be used for any
further processing.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nb">reload</span><span class="p">(</span><span class="n">pynoddy</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">MonteCarlo</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pynoddy.experiment.MonteCarlo</span> <span class="kn">import</span> <span class="n">MonteCarlo</span>
<span class="n">models</span> <span class="o">=</span> <span class="n">MonteCarlo</span><span class="o">.</span><span class="n">load_noddy_realisations</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> models loaded&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>8 models loaded
</pre></div>
</div>
<p>Now, lets draw some of them</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">models</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot_section</span><span class="p">(</span><span class="n">direction</span> <span class="o">=</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">ve</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/13-Monte-Carlo_10_0.png" src="_images/13-Monte-Carlo_10_0.png" />
<img alt="_images/13-Monte-Carlo_10_1.png" src="_images/13-Monte-Carlo_10_1.png" />
<img alt="_images/13-Monte-Carlo_10_2.png" src="_images/13-Monte-Carlo_10_2.png" />
<p>Finally, we should really (but don&#8217;t need to) delete all of the files
we&#8217;ve generated.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">gipps_mc</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Finito!&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Finito!
</pre></div>
</div>
<p>And now we&#8217;re all done. While the MonteCarlo class itself does not
perform any particularly exciting analyses, it provides an easy (and
fast) way of producing suites of randomly purturbed models.</p>
<p>See the Topology Analysis and Uncertainty Analysis notebooks for
examples of the types of analyses that the MonteCarlo class allows.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Analysis of uncertainty propagation with Monte Carlo sampling</a><ul>
<li><a class="reference internal" href="#using-the-monte-carlo-experiment-class">Using the Monte-Carlo experiment class</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/13-Monte-Carlo.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pynoddy  documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Florian Wellmann.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>